from distutils.command.clean import clean
from py2neo import Graph,Node,Relationship
import json
import os
from py2neo.matching import *

KGraph = Graph(
    "http://nju.csuncle.com:7474", 
    auth=("neo4j","wlm94929")
)

CVE="CVE-2021-44228"

nmatcher = NodeMatcher(KGraph)
cve_result = nmatcher.match('CVE',name=CVE).first()
if cve_result==None:
    print("CVE Not Found!")

rmatcher=RelationshipMatcher(KGraph)
cwe_results=rmatcher.match([cve_result], r_type='hasWeaknees').all()
if cwe_results==Node:
    print("CWE Not Found!")

capec_nodeset=[]
for cwe_item in cwe_results:
    capec_results=rmatcher.match([cwe_item.nodes[1]], r_type='CWE2CAPEC').all()
    for capec_r_item in capec_results:
        capec_nodeset.append(capec_r_item.nodes[1])

#针对每一个capec，从表格里找出前缀，识别它的后缀。
# 里面没有的从CVE的CVSS补齐，然后作为终结的节点

